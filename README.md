# 火山引擎语音合成（TTS）WebSocket中转服务

这是一个基于Go语言的中转服务程序，用于将OpenAI TTS协议转换为火山引擎TTS WebSocket协议，实现双向协议转换。客户端通过OpenAI TTS协议请求服务后，程序将请求转换为字节跳动的WebSocket协议向字节跳动服务器请求服务，然后将字节跳动服务通过WebSocket返回的流式音频转换为OpenAI TTS流式服务供客户端使用。

## 功能特性

- 支持两种语音合成方式：
  - 一次性合成：一次性发送全部文本，接收完整音频数据
  - 流式合成：支持流式接收数据（服务端分段返回音频），客户端一次性发送完整文本，更适合长文本合成
- 支持gzip压缩和解压缩，优化数据传输
- 支持自定义语音参数：音色、语速、音量、音调等
- 提供完整的协议解析和错误处理

## 环境要求

- Go 1.13+（推荐）
- 网络连接（需能访问火山引擎TTS服务）

## 安装依赖

该项目依赖以下Go包：

```bash
go get github.com/gorilla/websocket
go get github.com/satori/go.uuid
```

## 配置说明

在使用前，需要修改以下配置参数：

1. `appid`：从火山引擎平台获取的应用ID
2. `token`：从火山引擎平台获取的访问令牌
3. `cluster`：指定使用的集群名称
4. `voice_type`：指定使用的音色（在函数调用时设置）

## 使用方法

### 一次性合成

使用`nonStreamSynth`函数进行一次性合成：

```go
nonStreamSynth("要合成的文本", "音色ID", "输出音频文件路径.mp3")
```

### 流式合成

使用`streamSynth`函数进行流式合成：

```go
streamSynth("要合成的文本", "音色ID", "输出音频文件路径.mp3")
```

### 示例调用

当前示例在`main`函数中演示了流式合成的使用方式：

```go
func main() {
    // 将xxxx替换成需要调用的音色ID
    streamSynth("我想测试下语音合成的效果", "xxxx", "test.mp3")
}
```

## 运行示例

1. 修改代码中的配置参数
2. 运行程序：

```bash
go run tts\ websocket\ server.go
```

## 协议说明

该客户端实现了火山引擎TTS WebSocket二进制协议，包括：

- 协议头部定义
- 消息类型处理
- 压缩和解压缩机制
- 序列化为JSON格式

## 注意事项

1. 请确保替换代码中的占位符（如`appid`、`token`、`cluster`、`voice_type`等）为实际有效值
2. 对于长文本，建议使用流式合成方式以获得更好的性能
3. 该示例仅供参考，在生产环境中使用时请根据实际需求进行优化和完善
4. 请遵守火山引擎TTS服务的使用规范和限制

## 错误处理

程序包含基本的错误处理机制，能够捕获并输出常见的错误情况，如连接失败、消息发送/接收失败、协议解析错误等。

## 许可证

该示例代码仅供学习和参考使用。